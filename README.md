# Music Album Guide
## Справочник по музыкальным альбомам

### Описание проекта:
Проект состоит из сервисов фронтенда (Django, drf, httpx), бэкенда (Django, drf), СУБД PostgreSQL и сервера nginx, демонстрирует взаимодействие клиента фронтенда с API бэкенда, на чьей стороне происходит работа с данным, в том числе сортировка запрашиваемых данных.
На стороне фронтенда происходит десериализация полученных данных и отрисовка шаблона заполняемой ими таблицы (server-side rendering). В таблице предусмотрена возможность сортировки записей по столбцам "название альбома" и "имя артиста".
Cтатика (стили css таблицы фронтенда и страниц drf api backend'а) отдаётся сервером nginx, который в проекте выполняет роль reverse proxy.
Код проекта был проверен (wemake-python-styleguide, mypy) и местами был подвергнут рефакторингу.

## Развертывание проекта:
### Системные требования
Предполагается, что в системе уже установлен орекестратор ***docker-compose*** и пакетный менеджер ***poetry***.
### 1. Файлы с настройками
Переменные окружения, необходимые для работы проекта,
загружаются при его запуске из файла
****.env**** - для рабочего запуска
и ****.local.env**** - для локального запуска.
Образец их заполнения содержится в файле ****default.env****.
### 2. Использование Makefile'a
Для запуска необходимых команд в проекте испрользуются Makefile'ы, запускаемые программой make (на Linux-системах make чаще всего входит в стандартную поставку, на Windows рекомендуется установить make отдельно, иначе нужно запускать команды docker-compose, которые можно посмотреть в соответствующих Makefile'ах)

Для запуска проекта нужно запусить его сервисы в docker-compose, выполнив в его корневой директории команду:
```bash
make install
```
Для заполнения базы данных из csv-файлов-источников (которые расположены в поддиректории проекта /source и должны называться albums.csv, artists.csv, tracks.csv (их можно редактировать или заменять по своему усмотрению)) нужно выполнить следующую команду:
```bash
make populate.db
```
Далее необходимо собрать все статические файлы бэкенда и фронтенда, чтобы из web-страницы отрисовывались 
правильно (в backend'е отображаются drf эндпойнт и swagger документация):
```bash
make frontend.collecstatic
```
```bash
make backend.collectstatic
```
После выполнения второй команды в терминале будет отображен вопрос%
***This will overwrite existing files!
Are you sure you want to do this?***
на него нужно ответить **yes**.

После выполнения этого шага будут доступны эндойнты сервисов:
Локально страница фронтенда доступна по адресу
[http://localhost:1337/index](http://localhost:1337/index)

Backend A.P.I.: [(http://localhost:137/api/v1/albums/](http://localhost:137/api/v1/albums/)

### Остановка сервисов
Для остановки контейнеров:
```bash
make down
```
Для остановки диска:
```bash
make volumes.down
```
### Отображение логов
Для вывода логов контейнеров доступны следующие команды:

логи базы данных:
```bash
make postgres.logs
```
логи backend'а:
```bash
make backend.logs
```
логи frontend'a:
```bash
make frontend.logs
```
Логи nginx и postgres можно посмотреть, выполнив аналогичные команды.
## Запуск сервисов для их отладки
С целью отладки можно запускать сервисы backend'а и frontend'а локально.
Для этого предварительно нужно запустить отдельно контейнер отладочной базы данных (Postgres):
```bash
make local.db.install
```

Далее для запуска нужного сервиса необходимо перейти в соответствующую директорию и использовать таргеты из Makefile'ов в них,
предварительно активировав виртуальное окружение в ней:
```bash
poetry shell
```
Для корректной локальной работы проекта необходимо запусить сервисы frontend'а и backend'а одновременно в двух разных терминалах или IDE.

для остановки контейнера локальной базы данных в конце отладки:
```bash
make local.db.down
```

Локально страница фронтенда доступна по адресу
[localhost:7000/index](http://localhost:7000/index)

Backend A.P.I.: [localhost:8000/api/v1/albums/?sorting=album](http://localhost:8000/api/v1/albums/?sorting=album)